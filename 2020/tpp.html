<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)

	Modified by Alex Fern√°ndez
	https://pinchito.es/ | @pinchito
-->
<html>
	<head>
		<title>La metodolog√≠a TPP</title>
		<meta charset="utf-8" />
		<meta name="description" content="La metodolog√≠a TPP ‚Äî Todo Para
Producci√≥n v1" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@pinchito" />
		<meta name="twitter:title" content="La metodolog√≠a TPP ‚Äî Todo Para
Producci√≥n v1" />
		<meta name="twitter:description" content="" />
		<meta name="twitter:image" content="" />
		<link rel="stylesheet" href="/css/main.css" />
		<link rel="canonical" href="https://pinchito.es/2020/tpp" />
		<link rel="shortcut icon" href="/favicon.png" type="image/png" />
		<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie8.css" /><![endif]-->
	</head>
	<body>

		<!-- Header -->
			<section id="header">
				<header>
					<p class="home"><a class="home" href="/">pinchito.es</a></p>
					<p>
					<a href="/about">about</a>
					<br/>
					<a href="/cv">CV</a>
					<br/>
					<a href="/speaker">speaker</a>
					<br/>
					<a href="/rss.xml">
						<svg aria-hidden="true" class="rss-icon" width="18" height="18" viewBox="0 0 18 18"><path d="M3 1a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm0 1.5c6.9 0 12.5 5.6 12.5 12.5H13C13 9.55 8.45 5 3 5zm0 5c4.09 0 7.5 3.41 7.5 7.5H8c0-2.72-2.28-5-5-5zm0 5c1.36 0 2.5 1.14 2.5 2.5H3z"></path></svg>
						RSS feed</a>
					</p>
					<p>
					<a id="follower" href="https://twitter.com/intent/follow?screen_name=pinchito" target="_blank"><i id="birdie"></i>@pinchito</a>
					<br />
					<a rel="me" href="https://mastodon.social/@pinchito" target="_blank">üêò @pinchito@mastodon.social</a>
					<br/>
					<a href="https://github.com/alexfernandez" aria-label="Follow @alexfernandez on GitHub">alexfernandez @ GitHub</a>
					</p>
					<p>
					This site is cookie free! No tracking is done on your browser.
					</p>
					<a href="https://librecounter.org/referer/show" target="_blank">
					<img src="https://librecounter.org/counter.svg" referrerPolicy="unsafe-url">
					</a>
				</header>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

						<section id="zero">
							<p class="home"><a class="home" href="/">pinchito.es</a></p>
						</section>

						<!-- One -->
							<section id="one">
								<div class="container">
									<header class="major">
										<h1>La metodolog√≠a TPP</h1>
										<p>Todo Para Producci√≥n v1<p>
									</header>
																				<figure>
<img src="pics/tpp-ramas.png"
title="Ejemplo de organizaci√≥n de ramas en TPP. Fuente: elaboraci√≥n propia."
alt="Crea rama, a√±ade cambios, revisa, mezcla, crea tag, despliega." />
<figcaption aria-hidden="true">Crea rama, a√±ade cambios, revisa, mezcla,
crea <em>tag</em>, despliega.</figcaption>
</figure>
<p>En esta sencilla metodolog√≠a mantenemos s√≥lo una rama activa, ll√°mese
<em>master</em> o <a
href="https://github.com/github/renaming"><em>main</em></a>.</p>
<ul>
<li>Sacamos una rama para hacer un arreglo (<em>fix</em>) o una nueva
funcionalidad (<em>feature</em>).</li>
<li>A√±adimos cambios (<em>commits</em>) a la rama.</li>
<li>Creamos una petici√≥n de mezcla (<em>pull request</em> o <em>merge
request</em>).</li>
<li>Se van haciendo revisiones, a√±adiendo nuevos cambios y pasando los
tests.</li>
<li>Cuando los cambios est√°n revisados y los tests pasan, mezclamos los
cambios (hacemos <em>merge</em>).</li>
<li>De nuevo se vuelven a pasar los tests en <em>master</em>.</li>
<li>Una vez que los tests pasan, desplegamos en producci√≥n.</li>
<li>A continuaci√≥n etiquetamos la versi√≥n (<em>tag</em>).</li>
</ul>
<h2 id="de-d√≥nde-viene-tpp">¬øDe d√≥nde viene TPP?</h2>
<p>Durante mis muchos a√±os como desarrollador me he encontrado con
muchas ‚Äúmetodolog√≠as‚Äù de desarrollo. Una de las m√°s perniciosas
√∫ltimamente es <a
href="https://nvie.com/posts/a-successful-git-branching-model/">git-flow</a>,
en la que se mantienen m√∫ltiples ramas para diferentes versiones. M√°s
abajo la veremos m√°s en detalle.</p>
<p>Me atrevo a proponer p√∫blicamente TPPv1: Todo Para Producci√≥n v1, o
<em>ToPaProd</em> para amiguis y coleguis. Es una simplificaci√≥n radical
apta tanto para servicios online como para librer√≠as.</p>
<h3 id="tpp-para-librer√≠as">TPP para librer√≠as</h3>
<p>En librer√≠as (para <code>npm</code>, <code>maven</code> o similares)
las etiquetas son particularmente importantes: identifican la versi√≥n
concreta de la librer√≠a que se va a usar.</p>
<p>Seguiremos <a href="https://semver.org/">Semantic Versioning</a> a
rajatabla. Las versiones se etiquetar√°n como <em>x.y.z</em>, donde:</p>
<ul>
<li>x: versi√≥n mayor (major). Rotura de compatibilidad ‚áí cambia x.</li>
<li>y: versi√≥n menor (minor). Cambio de funcionalidad ‚áí cambia y.</li>
<li>z: versi√≥n parche (patch). Arreglo de bugs ‚áí cambia z.</li>
</ul>
<p>Cada versi√≥n debe ser <strong>inmutable</strong>: est√° prohibid√≠simo
publicar dos versiones diferentes con la misma etiqueta.</p>
<p>En caso de fallo es trivial hacer una vuelta atr√°s a una versi√≥n
anterior: s√≥lo tenemos que apuntar a la √∫ltima etiqueta v√°lida.</p>
<h3 id="tpp-para-sistemas-online">TPP para sistemas online</h3>
<p>Para sistemas online no necesitamos mantener m√∫ltiples versiones;
basta con mantener una √∫nica versi√≥n viva que es la que mantenemos en
<em>master</em>.</p>
<p>Una variante muy relevante en este caso consiste en mantener una rama
adicional estable, donde mezclamos s√≥lo el c√≥digo que pasa las pruebas.
Esta rama se puede llamar <em>stable</em>, <em>prod</em> o similar.
Desplegaremos a producci√≥n siempre desde la rama estable.</p>
<figure>
<img src="pics/tpp-estable.png"
title="Ejemplo de organizaci√≥n con rama estable para sistemas online. Fuente: elaboraci√≥n propia."
alt="Rama estable: tras mezclar en main, y s√≥lo si pasan los tests, mezclamos en stable y desplegamos desde ah√≠." />
<figcaption aria-hidden="true">Rama estable: tras mezclar en
<em>main</em>, y s√≥lo si pasan los tests, mezclamos en <em>stable</em> y
desplegamos desde ah√≠.</figcaption>
</figure>
<p>En este caso las etiquetas o <em>tags</em> son menos importantes e
incluso se pueden omitir. Para desplegar simplemente hacemos un
<code>git pull</code>, y si es necesario lanzamos un build.</p>
<h3 id="los-tests-de-master-no-pasan">¬°Los tests de <em>master</em> no
pasan!</h3>
<p><strong>La rama <em>master</em> debe estar siempre
desplegable.</strong> Si una vez mezclada una rama los tests fallan, lo
trataremos como prioridad m√°xima, con casi la misma severidad que un
fallo en producci√≥n. Es cierto que una versi√≥n que no pasa las pruebas
ni se etiqueta ni se despliega, pero estaremos estorbando el trabajo de
otros equipos que quieran mezclar a <em>master</em>.</p>
<h2 id="comparaci√≥n-con-otras-metodolog√≠as-de-desarrollo">Comparaci√≥n
con otras metodolog√≠as de desarrollo</h2>
<p>El sentido de metodolog√≠a se ha ido refinando; en este caso queremos
decir ‚Äúforma de organizar los cambios en el c√≥digo‚Äù, lo que se
corresponde con un <em>workflow</em> de desarrollo.</p>
<h3 id="gitflow">GitFlow</h3>
<p>Esta metodolog√≠a se liber√≥ en 2010 y tuvo bastante √©xito en m√∫ltiples
√°mbitos. Combina</p>
<ul>
<li>ramas para cada funcionalidad o <em>feature braches</em>,</li>
<li>ramas para cada versi√≥n o <em>release branches</em>,</li>
<li>una rama <em>master</em> para versiones definitivas,</li>
<li>una rama <em>develop</em> para desarrollo,</li>
<li>y otra rama <em>hotfixes</em> para arreglos r√°pidos.</li>
</ul>
<figure>
<img src="pics/tpp-gitflow.png"
title="La cl√°sica gr√°fica de GitFlow, con varias ramas de funcionalidad o _feature branches_, una rama _master_ y una rama _develop_. Fuente: https://nvie.com/posts/a-successful-git-branching-model/."
alt="GitFlow: se mantienen m√∫ltiples ramas vivas." />
<figcaption aria-hidden="true">GitFlow: se mantienen m√∫ltiples ramas
vivas.</figcaption>
</figure>
<p>El esfuerzo para mantener tant√≠simas ramas s√≥lo es posible para
grandes organizaciones con un mont√≥n de recursos. El propio autor aclara
<a href="https://nvie.com/posts/a-successful-git-branching-model/">al
principio de la p√°gina</a>:</p>
<blockquote>
Si tu equipo hace entrega continua de software, os sugerir√≠a un
<em>workflow</em> mucho m√°s sencillo (como GitHub flow) en lugar de
intentar meter git-flow con calzador en vuestro equipo.
</blockquote>
<h3 id="github-flow">GitHub Flow</h3>
<p>Entonces, ¬øes mejor GitHub Flow? En esta metodolog√≠a <a
href="https://docs.github.com/en/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/github-flow">propuesta
por GitHub</a> se trabaja de forma similar: se crea rama, se a√±aden
cambios, se revisan y se mezclan.</p>
<figure>
<img src="pics/tpp-github-flow.png"
title="Rama con GitHub Flow: Crea rama, a√±ade cambios, revisa, testea, despliega _y luego_ mezcla. Fuente: https://guides.github.com/introduction/flow/."
alt="GitHub Flow: cuando pasan los tests desplegamos el contenido de la rama, en lugar de main." />
<figcaption aria-hidden="true">GitHub Flow: cuando pasan los tests
desplegamos el contenido de la rama, en lugar de
<em>main</em>.</figcaption>
</figure>
<p>Podemos ver en <a
href="https://docs.github.com/en/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/github-flow">la
gu√≠a gr√°fica</a> la diferencia m√°s radical con TPP: en GitHub Flow
<strong>se hacen los despliegues desde la rama</strong>, antes de
mezclar. Esto tiene el gran problema de que es posible que haya cambios
en <em>main</em> que no se van a desplegar, ya que no est√°n en la rama;
hay que asegurarse de hacer un <code>git pull origin main</code> antes
de desplegar y mezclar.</p>
<p>Me parece mucho m√°s robusto desplegar desde <em>main</em> una vez
mezclados los cambios.</p>
<h2 id="conclusiones">Conclusiones</h2>
<p>Si quieres desplegar c√≥digo de forma sencilla, mantener s√≥lo una
versi√≥n, y optimizar los esfuerzos del equipo, ¬°p√°sate a TPP!</p>
<h3 id="agradecimientos">Agradecimientos</h3>
<p>Gracias a mis compa√±eros en diversas empresas: <a
href="https://mediasmart.io/">mediasmart.io</a>, <a
href="https://www.devo.com/">Devo</a>, <a
href="https://influencity.com/">Influencity</a> y √∫ltimamente <a
href="https://leanmind.es/">LeanMind</a> por ayudarme a probar diversas
formas de desplegar c√≥digo. Gracias a todos los alumnos del <a
href="/2020/curso-escalabilidad">curso de escalabilidad</a> por ayudarme
a refinar la metodolog√≠a.</p>
								</div>
							</section>
							<section id="last">
								<div class="container">
									<p>
									Publicado el 2020-11-01, modificado el 2020-11-01. <a
href="mailto:alexfernandeznpm@gmail.com">¬øComentarios, sugerencias?</a>
									</p>
									<p>
									Back to the <a href="/">index</a>.
									</p>
								</div>
							</section>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<ul class="copyright">
								<li>
									¬© <a href="mailto:alexfernandeznpm@gmail.com">Alex Fern√°ndez</a>.
									<a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.
								</li>
								<li>Original design: <a href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</section>

			</div>
	</body>
</html>
