<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Adventures in the Land of Go</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="../css/main.css" />
		<link rel="shortcut icon" href="/favicon.png" type="image/png" />
		<!--[if lte IE 8]><link rel="stylesheet" href="../css/ie8.css" /><![endif]-->
	</head>
	<body>

		<!-- Header -->
			<section id="header">
				<header>
					<span class="image avatar"><a href="../index.html"><img src="../pics/avatar.jpg" alt="Avatar" /></a></span>
					<h1 id="logo"><a href="../index.html">Alex Fern√°ndez</a></h1>
					<p>
					I am a developer (little) known on Twitter as <a href="https://twitter.com/pinchito">pinchito</a>.
					</p>
				</header>
				<!--
				<nav id="nav">
					<ul>
						<li><a href="#one" class="active">About</a></li>
						<li><a href="#two">Things I Can Do</a></li>
						<li><a href="#three">A Few Accomplishments</a></li>
						<li><a href="#four">Contact</a></li>
					</ul>
				</nav>
				<footer>
					<ul class="icons">
						<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon fa-envelope"><span class="label">Email</span></a></li>
					</ul>
				</footer>
				-->
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

						<!-- One -->
							<section id="one">
								<div class="container">
									<header class="major">
										<h1>Adventures in the Land of Go</h1>
										<p>Or the Ungoogleable Language from Google<p>
									</header>
										<div class="figure">
<img src="pics/attendance.jpg" title="View of Attendance at a Movie in Permanent Recreation Building" alt="Picture credit: Department of Navy, USA" /><p class="caption">Picture credit: <a href="https://commons.wikimedia.org/wiki/File:Photograph_with_caption_%22View_of_Attendance_at_a_Movie_in_Permanent_Recreation_Building,%22_U.S._Naval_Ammunition..._-_NARA_-_283490.jpg">Department of Navy, USA</a></p>
</div>
<p>This week I had the opportunity to play with Go (or &quot;Golang&quot; as has come to be known) for a work-related project. It is not the first occasion that we meet, but now I am serious about it. And I have to vent my frustrations with the language.</p>
<h2 id="the-language">The Language</h2>
<h3 id="adding-elements-to-an-array">Adding Elements to an Array</h3>
<p><a href="https://blog.golang.org/slices">arrays are different from slices</a>.</p>
<h3 id="error-management">Error Management</h3>
<p>Sick of the <code>if (error) return callback(error)</code> bullshit? Brace yourself.</p>
<p>Functions can return several arguments:</p>
<pre><code>func getObject(value Object) (Object, error) {
    return value, nil
}</code></pre>
<p>Cool, you can return <code>nil</code> instead of the second argument. So you probably can return <code>nil</code> also as the first argument if there is an error? <strong>Bzzzt!</strong> Wrong. <em>Obviously</em> you cannot [return <code>nil</code> as a struct], for reasons that are very well explained in that link (but I will not probably understand if I live five consecutive lives).</p>
<p>So when you find an error you have to return an empty object, which must be initialized first:</p>
<pre><code>func getObject(value Object) (Object, error) {
    newObject, err := accessSomeDB(value.Key)
    empty := Object{}
    if err != nil {
        return empty, nil
    }
    return value, nil
}</code></pre>
<p>So now be ready to write this bit quite often:</p>
<pre><code>if err != nil {
    return empty, nil
}</code></pre>
<p>Of course, with non-optional braces. At least the <code>if (error) return callback(error)</code> was an invariant.</p>
<h3 id="variable-declarations">Variable Declarations</h3>
<p>This one looks inoffensive enough but can be most annoying. To declare and define (give value) a variable you use the <code>:=</code> operator:</p>
<pre><code>a := 5</code></pre>
<p>While to just give a value to an existing variable you use the <code>=</code> operator:</p>
<pre><code>var a string;
a = 5</code></pre>
<p>So, what happens is that if your code uses the same variable several times (for instance the ubiquitous <code>err</code>) you will find this joy:</p>
<pre><code>err := callFirst()
err := callSecond()</code></pre>
<p>results in</p>
<pre><code>main.go:10: no new variables on left side of :=</code></pre>
<p>Therefore you have to change the second invocation to:</p>
<pre><code>err := callFirst()
err = callSecond()</code></pre>
<p>Ending one of the joys of programming, the ease of copy-paste. Or defining the variable ahead of time with this clumsy wart:</p>
<pre><code>var err error</code></pre>
<p>Observe that the error message says &quot;no new variables&quot;: it is OK to reuse <code>err</code> as long as there is a new variable there.</p>
<pre><code>first, err := callFirst()
second, err := callSecond()</code></pre>
<p>This works! So one new variable and one old variable is fine; but only one old variable is not. Even ignoring the return value is <em>not</em> OK:</p>
<pre><code>_, err := callFirst()
_, err := callSecond()</code></pre>
<p>This fails, don't ask me why; just the compiler being helpful I guess. The end result is that you spend time changing <code>=</code> to <code>:=</code> and viceversa, for no good reason. I'm too old for this crap.</p>
<h3 id="implicit-conversions">Implicit Conversions</h3>
<p>Did you know that in Go you cannot simply divide <code>6 / 4</code> and expect the answer to be <code>1.5</code>? It does not <a href="https://groups.google.com/forum/#!topic/golang-nuts/LXL4L0jzWXU">perform implicit conversions</a> as you might expect from a language designed this century. So you first have to do an explicit conversion, leading to such fun errors as:</p>
<blockquote>
<p>cannot use n / d (type int) as type float32 in return argument</p>
</blockquote>
<p>But as it happens, Go isn't even able to compare an integer with a float:</p>
<pre><code>    var myFloat = float64(5)
    var myInt = 5
    if myFloat &gt; myInt {
        return true
    }   
...

invalid operation: myFloat &gt; myInt (mismatched types float64 and int)</code></pre>
<p>I think this is a bit too much. This is why you will occasionally see unholy messes like this:</p>
<pre><code>    var myFloat = float64(5)
    var myInt = 5
    if myFloat &gt; float64(myInt) {
        return true
    }   </code></pre>
<h3 id="mandatory-brace-style">Mandatory Brace Style</h3>
<p>Some people like the correct style for braces: nice and symmetrical. I'm talking of course of the &quot;brace on the next line&quot; school of thought:</p>
<pre><code>if something
{
    something else
}</code></pre>
<p>Other people like the more compact notation with &quot;brace on the same line&quot;:</p>
<pre><code>if something {
    something else
}</code></pre>
<p>It is of course wrong, and in fact many of the proponents then add an empty line.</p>
<p>Here Go takes sides, and chooses the worst possible solution: mandating one true style. From the <a href="https://golang.org/doc/faq#semicolons">FAQ</a>:</p>
<blockquote>
<p>the advantages of a single, programmatically mandated format for all Go programs greatly outweigh any perceived disadvantages of the particular style.</p>
</blockquote>
<p>That is not cool, people. You may shut up Googlers from having the sempiternal brace debate, but you cannot <a href="https://groups.google.com/forum/#!topic/golang-nuts/rzLzp_Z74ik%5B1-25%5D">shut</a> <a href="https://www.reddit.com/r/golang/comments/2jpzpd/brace_yourself_a_small_script_for_converting/">us</a> <a href="http://zerospace.org/goallman.php">people</a> <a href="http://comments.gmane.org/gmane.comp.lang.go.general/19965">up</a>!</p>
<h3 id="just-making-shit-up">Just Making Shit Up</h3>
<p>Sometimes you get the impression that, as the creators of Go went along, they realized that it lacked some very basic capability and added it as a <a href="https://golang.org/pkg/builtin/">&quot;built-in function&quot;</a>. There are 15 of these abominations.</p>
<p>A good example is <a href="https://blog.golang.org/go-maps-in-action">maps</a>. So you declare an array of campaigns:</p>
<pre><code>var campaigns map[string]Campaign</code></pre>
<p>But then have to populate it, how? Easy, with a built-in function:</p>
<pre><code>campaigns = make(map[string]Campaign)</code></pre>
<p>There you have to specify the kind of map you want to make, again. Why? You already know the type, Obnoxious Gopher!</p>
<p>The fun doesn't end with <code>make()</code> though. Just look at what they have to say about <code>println()</code>:</p>
<blockquote>
<p>Println is useful for bootstrapping and debugging; it is not guaranteed to stay in the language.</p>
</blockquote>
<p>Therefore declaring that bootstrapping and debugging is not guaranteed for these frolicking gophers.</p>
<p>Granted, there are also built-in functions in JavaScript, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects">about 12</a>. Of these, <code>escape()</code> and <code>unescape()</code> are holdouts from a different era; <code>eval()</code> is widely discredited.</p>
<p>In the end <code>parseInt()</code>, <code>parseFloat()</code> and the URI things are the only functions in use, and they are quite low-level really.</p>
<h2 id="the-toolchain">The Toolchain</h2>
<h3 id="anal-retentive-compiler.">Anal Retentive Compiler.</h3>
<p>Nothing that has not been <a href="http://www.evanmiller.org/four-days-of-go.html">said better before</a>. Just one nitpick: why forbid unused imports and variables, but allow unused functions? Aren't unused functions equally (or even more) dangerous? This question has been bothering me for some time.</p>
<h2 id="the-help">The Help</h2>
<p>With JavaScript finding help is very easy: the semi-official docs are in</p>
<p>Now Go had it <em>much</em> easier: there is an official creator, sponsor and source for everything Go. Why then is everything spread in a lot of places?</p>
<ul>
<li><p>Some questions are answered on StackOverflow, yes, but others are only found in arcane Google Groups, and even others are on Reddit, for crying out loud.</p></li>
<li><p>The official documentation is too terse and lacks examples. For those, you have to go to <a href="https://blog.golang.org/">The Go Blog</a>, or just start browsing random blogs.</p></li>
</ul>
<h2 id="the-redis-driver">The Redis Driver</h2>
<p>So you want to do some easy task, say: access a local Redis database. Let's find a simple driver. Redis is one of the <a href="http://stackshare.io/posts/top-50-developer-tools-and-services-of-2015#top-50">most popular NoSQL databases</a>, and Golang has <a href="http://www.modulecounts.com/">more than 100k packages</a>, rivalling Maven or rubygems. So it shouldn't be hard, right?</p>
<div class="figure">
<img src="pics/modulecounts.png" title="Module Counts for many popular package repositories" alt="Module Counts" /><p class="caption"><a href="http://www.modulecounts.com/">Module Counts</a></p>
</div>
<p>Right???</p>
<h3 id="redigo">Redigo</h3>
<p>This is one of <a href="http://redis.io/clients#go">the recommended clients for Redis</a>. The <a href="https://godoc.org/github.com/garyburd/redigo/redis">documentation</a> is cryptic to the extreme.</p>
<h3 id="go-redis">Go-redis</h3>
<p>Complete, and well documented. Nice, huh? So you want to install onto your Debian testing machine, and this happens:</p>
<pre><code>$ go get gopkg.in/redis.v3
# gopkg.in/redis.v3
../../.gocode/src/gopkg.in/redis.v3/pool.go:144: undefined: atomic.Value</code></pre>
<p>What is this evil? Googling <code>go-redis &quot;undefined: atomic.Value&quot;</code> will not yield an answer, but Google helpfully removes the quotes and returns this <a href="https://github.com/ethereum/go-ethereum/issues/1584">related page</a> for a different project:</p>
<blockquote>
<p>You need Go 1.4 or a later version to build go-ethereum.</p>
</blockquote>
<p>Alas, Debian packs Go 1.3, and the latest Ubuntu with long term support (14.04) is even worse: Go 1.2.</p>
<p>So at this point backwards compatibility is not one of the selling points for Go.</p>
<h3 id="radix">Radix</h3>
<p>This recommended <a href="https://github.com/mediocregopher/radix.v2">package</a> is broken into several subpackages. I don't know where to start here.</p>
<h3 id="godis">Godis</h3>
<p>This driver works reasonably well, but it hasn't been updated since 2012. An ominous note on <a href="https://github.com/simonz05/godis">the front page</a> states:</p>
<blockquote>
<p>13 Aug 2012 Currently very busy with work, and I don't have the time to fix some of the pending issues at hand.</p>
</blockquote>
<p>And nothing else, looks like the recovered diary from a long lost expedition.</p>
<p>So now let's read a hash of organizations from Redis:</p>
<pre><code>elem, err := driver.Hgetall(key)
if err != nil {
    return err
}
log.Printf(&quot;orgs &quot;, len(elem.Elems))
if len(elem.Elems) == 0 {
    return errors.New(&quot;Organizations not found&quot;)
}
for index, subelem := range elem.Elems {
    log.Printf(&quot;read &quot;, subelem.Elem.String())
    if index % 2 == 0 {
        continue
    }
    organization := Organization{}
    err = json.Unmarshal(subelem.Elem.Bytes(), &amp;organization)
    if err != nil {
        return err
    }
    err = readCampaigns(organization.Id)
    if err != nil {
        return err
    }
}
log.Printf(&quot;Read %v campaigns&quot;, len(campaigns))
return nil</code></pre>
<p>This is like a kaleidoscope of weird issues.</p>
<p>Since Go doesn't have generics, you will have to repeat this crappy code every time you want to read a different hash.</p>
<h2 id="a-might-have-been">A Might Have Been</h2>
<p>So, what drove Google to create a new language?</p>
<h3 id="the-bleeding-name">The Bleeding Name</h3>
<p>People, if you ever create a language, use a distinctive word that can be googled. &quot;Golang&quot; would have been fine; &quot;Go&quot; is <a href="http://www.wordfrequency.info/free.asp?s=y">the 35th most common word in English</a>. Not cool.</p>
<h3 id="what-could-have-been">What Could Have Been</h3>
<p>All these annoyances are not only a pain in the ass, but make Go a huge missed opportunity.</p>
<p>It is a pity because I liked the idea very much: a compiled language that is very performant and which solves concurrency with elegance. A noble successor to C indeed. But if there is something that C is not, is opinionated: it adapts to your style and is flexible enough to accomodate everyone. Alas, that is something that the creators of Go deemed <a href="https://golang.org/doc/faq#semicolons">unworthy of their time</a>.</p>
								</div>
							</section>
							<section id="last">
								<div class="container">
									<p>
									Published on 2016-02-18. <script type="text/javascript">
<!--
h='&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#x6f;&#x6d;';a='&#64;';n='&#x61;&#108;&#x65;&#120;&#102;&#x65;&#114;&#110;&#x61;&#110;&#100;&#x65;&#122;&#110;&#112;&#x6d;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'">'+'Comments, improvements?'+'<\/'+'a'+'>');
// -->
</script><noscript>&#x43;&#x6f;&#x6d;&#x6d;&#x65;&#110;&#116;&#x73;&#44;&#32;&#x69;&#x6d;&#112;&#114;&#x6f;&#118;&#x65;&#x6d;&#x65;&#110;&#116;&#x73;&#x3f;&#32;&#40;&#x61;&#108;&#x65;&#120;&#102;&#x65;&#114;&#110;&#x61;&#110;&#100;&#x65;&#122;&#110;&#112;&#x6d;&#32;&#x61;&#116;&#32;&#x67;&#x6d;&#x61;&#x69;&#108;&#32;&#100;&#x6f;&#116;&#32;&#x63;&#x6f;&#x6d;&#x29;</noscript>
									</p>
									<p>
									Back to the <a href="../index.html">index</a>.
									</p>
								</div>
							</section>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<ul class="copyright">
								<li>&copy; <a href="mailto:alexfernandeznpm@gmail.com">Alex Fern√°ndez</a>. Distributed under the <a href="https://opensource.org/licenses/MIT">MIT license</a>.</li>
								<li>Original design: <a href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</section>

			</div>
	</body>
</html>
